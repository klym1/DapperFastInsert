version: '0.2.1'

image: Visual Studio 2017

install:
  - choco install dotnetcore-sdk --version 3.0.100

environment:
  Appveyor: true
  # MySQL
  MYSQL_PATH: C:\Program Files\MySql\MySQL Server 5.7
  MYSQL_PWD: Password12!
  MYSQL_ENV_MYSQL_USER: root
  MYSQL_ENV_MYSQL_PASSWORD: Password12!
  MYSQL_ENV_MYSQL_DATABASE: tests
services:
  - mysql

init:
  - SET PATH=%MYSQL_PATH%\bin;%PATH%

before_test:
  - mysql -e "CREATE DATABASE tests;" --user=root

artifacts:
  - path: .\.nupkgs\*.nupkg

nuget:
  disable_publish_on_pr: true

configuration: Release

dotnet_csproj:
  patch: true
  file: '**\*.csproj'
  version: '{version}'
  package_version: '{version}'
  assembly_version: '{version}'
  file_version: '{version}'
  informational_version: '{version}'

build_script:
  - cmd: dotnet pack ".\src\FastInsert\FastInsert.csproj" /p:PackageOutputPath=..\..\.nupkgs /p:NoPackageAnalysis=true /p:CI=true

test_script:
  - dotnet test src

deploy:
- provider: NuGet
  on:
    branch: master
  api_key:
    secure: RoAi8N5E0Reb5EmfE6VkpGFvSkXyi9ZjGzlqJSVU+WVZCo0qdixvxKdA5SBD0VYB
